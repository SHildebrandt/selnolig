% !TEX TS-program = lualatex
\documentclass[12pt]{article}

% This entire package is placed under the terms of the
% LaTeX Project Public License, version 1.3 or later
% (http://www.latex-project.org/lppl.txt).
% It has the status "maintained".
%
% Author: Mico Loretan (loretan dot mico at gmail dot com)
% Date: 2012/11/15

% Check first that we're running lua(la)tex.
\usepackage{ifluatex}
\ifluatex\else
  \typeout{=========================================}
  \typeout{The file selnolig.tex must be compiled   }
  \typeout{ using LuaLaTeX. Exiting immediately.    }
  \typeout{=========================================}
  \endinput
\fi

\usepackage{fontspec}
\setmainfont[Numbers = OldStyle,
    Ligatures  = {TeX, Common, Discretionary},
    ItalicFont = {Garamond Premier Pro Italic} ]
    {Garamond Premier Pro}
%\setmainfont[Numbers = OldStyle,
%    Ligatures  = {TeX, Common, Discretionary},
%    ItalicFont = {Minion Pro Italic} ]
%    {Minion Pro}

\setsansfont[Scale=MatchLowercase]{HelveticaNeue}
\setmonofont[Scale=MatchLowercase]{Consolas}

\newfontfamily\blackletterfont[Ligatures = NoCommon]
    {UnifrakturMaguntia}

\newfontfamily\ebg[Numbers    = OldStyle,
    Ligatures  = {TeX, Common, Discretionary},
    ItalicFont = {EB Garamond 12 Italic}]
    {EB Garamond 12 Regular}

\usepackage[english,broad-f,ngerman]{selnolig}
%\debugon 

% Suppress st-ligature in some German words
%    that occur in this document
\nolig{Kunststo}{Kuns|ts|to} % Kunststoff
\nolig{Bausto}{Baus|to}      % Baustoff
\nolig{streif}{s|treif}      % streifte
\nolig{instru}{ins|tru}      % Zupfinstrument
\nolig{justiz}{jus|tiz}      % Strafjustiz
\nolig{Konstanz}{Kon|stanz}	

\usepackage{geometry}
\usepackage[english=american]{csquotes}
\usepackage[ngerman,english]{babel}
\hyphenation{ver-werf-lich}
\usepackage{microtype}
\usepackage{multicol}

\usepackage{sectsty}
\allsectionsfont{\mdseries}

\usepackage{tocloft}
\cftsetindents{sec}{0em}{2em}
\cftsetindents{subsec}{2em}{2.25em}
\cftsetindents{subsubsec}{4.25em}{3em}
\renewcommand{\cfttoctitlefont}{\large}
\renewcommand{\cftsecfont}{\mdseries}
\renewcommand{\cftsecpagefont}{\mdseries}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

\usepackage{fancyvrb}
\DefineShortVerb{\|}

\usepackage[bottom,splitrule]{footmisc}

\usepackage[svgnames]{xcolor}
\usepackage[colorlinks=true,linktocpage,
   allcolors=DarkBlue]{hyperref}
\usepackage[capitalize,nameinlink,noabbrev]{cleveref}

% some frequently-used commands
\newcommand{\pkg}[1]{\textsf{#1}}
\newcommand{\opt}[1]{\texttt{#1}}
\newcommand{\cmmd}[1]{\texttt{\textbackslash #1}}

\let\oldappendix\appendix
\renewcommand\appendix{%
   \clearpage
   \addtocontents{toc}{\protect{\vspace\baselineskip}}
   \addtocontents{toc}{\protect{\mdseries Appendices\par}}
   \noindent
   {\Large Appendices}
   \oldappendix}

\frenchspacing
\clubpenalty10000
\widowpenalty10000

% The macros \pname, \pversion, and \pdate used below in
% '\title' and '\date' are defined in 'selnolig.sty'.

\title{The \pname\ package: \\
Selective suppression of typographic ligatures\thanks{
Current version: \pversion. Features of this package are subject to change without prior notice. The main text fonts used in the present user guide are \enquote{Garamond Premier Pro} (for the most part) and \enquote{EB Garamond} (for the parts that deal with the \bgroup\ebg \mbox{fb}, \mbox{fh}, \mbox{fk}, \mbox{ffb}, \mbox{ffh}, and \mbox{ffk} ligatures\egroup), \enquote{common} and \enquote{discretionary} ligatures are enabled for both text fonts. Sans-serif text portions are typeset in \enquote{Helvetica Neue,} and \enquote{Consolas} is used as the monospaced font.}}
\author{Mico Loretan\thanks{
\href{mailto:loretan.mico@gmail.com}{loretan dot mico at gmail dot com}.}}
\date{\pdate}


\begin{document}
\VerbatimFootnotes

\maketitle
\thispagestyle{empty}

\tableofcontents

\section{Introduction}

The ability of \TeX\ and Friends to use typographic ligatures has long been cherished by its users. Indeed, the automated and transparent use of typographic ligatures by \TeX\ and Friends is often held up by their users as one of the reasons for using these programs.

However, even though the automatic use of typographic ligatures is very useful in general, there are words for which the use of certain typographic ligatures may not be appropriate. The \TeX Book observes, on p.~19, that the word \enquote{\mbox{shelfful}} may look better if it is typeset as \enquote{shelfful}, i.e., \emph{without} the ff-ligature. Some other English-language words that would generally be considered to be good candidates for non-use of ligatures are \mbox{cufflink} and \mbox{offload}, compare their appearance with that of cufflink and offload. Observe that all of these words are composite, with the first word component (or morpheme) ending in an~\enquote{f\,} or~\enquote{ff\,} and the second component (morpheme) beginning with either an~\enquote{f\,} (in the case of shelfful) or an~\enquote{l} (in the cases of cufflink and offload). A morpheme, briefly stated, is the smallest linguistic unit within a word that bears distinct meaning. Thus, the words shelfful and offload each contain two morphemes. 

On the whole, though, the need to suppress typographic ligatures selectively for English language documents  generally does not appear to be an enormously pressing concern, possibly because English doesn't feature composite words that frequently. However, in some other languages, such as German, composite words are much more common, in such languages, there is naturally a much greater potential for composite words to feature f-f, f-l, f-i and other such character pairs (and triples) at morpheme boundaries. In German typography, the use of ligatures across morpheme boundaries is considered something to be avoided at (nearly) all cost, probably because ligatures that span morphemes have the potential to impair seriously the intelligibility of these words.\footnote{For German texts, I believe that the \emph{Duden} provides this sort of authoritative backing. For English texts, I'm actually not aware of a document issued by an official or quasi-official body that discourages the use of typographic ligatures across morpheme boundaries. If anybody can provide such a reference, I would be happy to list it.} Words such as \mbox{kopflos} and \mbox{elffach} (containing fl- and ff-ligatures) simply look wrong to a German reader, they should be typeset as kopflos and elffach, respectively.

\TeX\ and Friends offer several methods for suppressing ligatures on a case-by-case basis.\footnote{In \LaTeX, there are three basic methods for suppressing ligature within a character pair: (i)~insertion of an \enquote{empty atom}, |{}| between the characters, (ii)~insertion of an explicit italic correction, |\/|, and (iii)~insertion of an explicit \enquote{kern}, e.g., |\kern0pt| or \Verb/\hspace{0pt}/. The \pkg{babel} package, when used with the \opt{ngerman} option, offers the \enquote{shortcut} macro \Verb/"|/ for this purpose. Note, though, that the first ligature suppression method, \Verb/{}/, does \emph{not} work if the document is compiled with Lua\LaTeX.} However, these methods must be applied separately to each and every occurrence of all words that contain undesirable ligatures. As such, these methods are both time-intensive and tedious, and there's a residual risk that some words for which ligatures should be suppressed will be overlooked in the editing process. 

What has \emph{not} been available so far is a \LaTeX\ package that (i) specifies a list of word patterns and entire words for which ligatures should be suppressed and (ii) systematically discovers all instances of these words in a document and applies the non-ligation rules automatically. The \pkg{selnolig} package is meant to address this need. The package is currently set up to handle English and German language non-ligation issues by providing extensive lists of ligature suppression macros appropriate for the respective languages. Of course, no claim as to the completeness of either list is or can be made. The package therefore makes it easy for users to provide additional ligature suppression rules for words not already covered by the package.\footnote{If you discover such words, please email them to me so that I can augment the package's ligature suppression rules appropriately. A suggested template for reporting such cases is provided in \cref{sec:template}.} 

The \pkg{selnolig} package also provides additional hyphenation exception lists for both English and German language words. It is straightforward to extend the package to let it handle ligature suppression rules for other languages besides English and German. 

For both English and German language documents, the \pkg{selnolig} package provides macrs to suppress selectively the following f-ligatures: ff, fi, fl, ffi, and ffl\textemdash the \enquote{standard} f-ligatures that should be familiar to most users of Computer Modern fonts\textemdash as well as the~ft and~fft ligatures. The latter two ligatures, while not provided by the Computer Modern font family, are available frequently in \enquote{oldstyle} or \enquote{Garalde} font families.

For English language documents, the package's default setting is to suppress f-ligatures for only a fairly basic set of words. However, by providing the option \opt{broad-f}, additional f-ligatures can be suppressed, including for words that contain the {\ebg \mbox{fb}, \mbox{fh}, \mbox{fj}, and \mbox{fk}} character pairs. The package also recognizes an option called \opt{hdlig} to suppress selectively historic and discretionary ligatures, such as those for the ct, st, sp, \emph{th}, \emph{et}, and~\emph{as} character pairs. 


For German language documents, all instances of {\ebg \mbox{fb}, \mbox{fh}, \mbox{fj}, and~\mbox{fk}} ligatures are suppressed globally, see \cref{sec:global-nolig}. However, exceptions are provided in order \emph{not} to suppress these ligatures for selected words of non-German origin such as fjord, fjell, {\ebg Kafka}, and Prokofjew. At this time, no macros for the selective suppression of historic and/or discretionary ligatures are provided for German language documents.

Of course, if the fonts you employ for your documents do not provide these typographic ligatures, the presence of the ligature suppression rules will have no effect\textemdash other than to slow down compilation speed.

 

A comment on the classification of various forms of typographic ligatures. Among the ligature-rich OpenType fonts I'm familiar with that can be loaded via the \pkg{fontspec} package under Lua\LaTeX, there appears to a near-complete lack of terminological consistency as to which typographic ligatures\textemdash beyond the so-called \enquote{common} ligatures (mainly f-ligatures)\textemdash are labelled \enquote{historic} and which ones are labelled \enquote{discretionary.} For instance, the fonts Latin Modern Roman, EB Garamond 12 Regular, Garamond Premier Pro, and Hoefler Text report having \enquote{only} discretionary ligatures, whereas Junicode, Cardo, and Palatino Linotype report  featuring both historic and discretionary ligatures.\footnote{Separately, none of these fonts reports having ligatures classified as either \enquote{contextual} or \enquote{required}.} To simplify terminology, the \pkg{selnolig} package provides the \opt{hdlig} option to enable ligature suppression rules that could apply to either the \enquote{historic} or the \enquote{discretionary} groups of ligatures.

\section{I'm in a hurry! How do I start using this package?}

\subsection[How do I load the selnolig package?]{How do I load the \pkg{selnolig} package?}

\begin{itemize}
\item If your document is in English and you want to suppress f-ligatures for a \enquote{basic} set of words and word patterns, you should load the package as follows:
\begin{Verbatim}
     \usepackage[english]{selnolig}
\end{Verbatim}
Synonymous options for \opt{english} are \opt{UKenglish}, \opt{british}, \opt{USenglish}, \opt{american}, \opt{cana\-dian}, \opt{australian}, and \opt{new\-zealand}.

\begin{itemize}
\item If you want to load a broader set of f-ligature suppression rules than the set that's enabled by default, be sure to also specify the \opt{broad-f} option, see \cref{sec:eng-opt}.

\item If the font you use for your document also provides \enquote{historic} and/or \enquote{discretionary} ligatures (e.g., ct, st, sp, \emph{th}, \emph{as}, \emph{is}, \emph{us}, etc.), you should also specify the \opt{hdlig} option (in addition to the \opt{english} option, of course) when loading the \pkg{selnolig} package.\footnote{If the \pkg{selnolig} package is loaded \emph{after} the \pkg{fontspec} package, a macro is run to inquire if historic and/or discretionary ligatures are enabled; if the answer is yes, the \opt{hdlig} option is enabled automatically.}
\end{itemize}
\item If your document is written in German, load the package as follows:
\begin{Verbatim}
     \usepackage[ngerman]{selnolig}
\end{Verbatim}
Synonymous options for \opt{ngerman} are \opt{german}, \opt{austrian}, \opt{naustrian},  \opt{swissgerman}, and \opt{swiss}.

\item If you load the package \emph{without} an explicit language option, i.e., as
\begin{Verbatim}
     \usepackage{selnolig}
\end{Verbatim}
but if one or more of the language options noted above are specified as options to the \cmmd{documentclass} instruction, LaTeX will pass these options on to the \pkg{selnolig} package.

\item If no language options are set, either when the package is loaded or as options in the \cmmd{documentclass} instruction, loading the \pkg{selnolig} package will have no effect on the appearance of your document\textemdash unless you specify various \cmmd{nolig} macros on your own.
\end{itemize}


\subsection{Any hints on how to get started with Lua\LaTeX?}

The \pkg{selnolig} package requires Lua\LaTeX\textemdash it will \emph{not} work with either pdf\LaTeX\ or Xe\LaTeX. This requirement will likely force you to make some changes to the preambles of your existing \LaTeX\ files in order to make them compilable by Lua\LaTeX. The main changes you must apply are: (i)~remove (or comment out) any \Verb+\usepackage{inputenc}+ instructions that may be present, and (ii)~insert the instruction
\begin{Verbatim}
     \usepackage{fontspec}
\end{Verbatim}
in the preamble.

Of course, you'll also need to use a \TeX\ distribution that includes a fairly recent version of Lua\LaTeX. \TeX Live\,2012, Mac\TeX\,2012, and MiK\TeX\,2.9 all satisfy this requirement. If you use a command-line interface to compile your document named, say, |myfile.tex|, be sure to type 
\begin{Verbatim}
     lualatex myfile
\end{Verbatim}
rather than either |latex myfile| or |pdflatex myfile|. If you use an editor with pull-down menus or buttons to invoke \TeX, be sure to select |LuaLaTeX| rather than, say, |pdfLaTeX|.
Be forewarned that the first time you run Lua\LaTeX\ on your document with a new set of fonts, the compilation speed may be quite slow because Lua\LaTeX\ has to build various cache files for font-related information. Subsequent compilation runs should be much faster. 

Depending on your \TeX\ distribution, the default font family used by Lua\LaTeX\ will be either Computer Modern or Latin Modern. If you wish to use a different font family, further instructions will be required. How to specify fonts and font families and how to set up various font-related options in Lua\LaTeX\ are subjects that lie far beyond the scope of this user guide. I urge you to become familiar with the \href{http://www.ctan.org/tex-archive/macros/latex/contrib/fontspec/fontspec.pdf}{user guide} of the \pkg{fontspec} package to learn how to control a multitude of font-related options. The answers to the question \href{http://tex.stackexchange.com/q/28642/5001}{Frequently loaded packages: Differences between pdf\LaTeX\ and Lua\LaTeX?}, posted on \href{http://tex.stackexchange.com/}{tex.s\breaklig tackexchange.com}, contain some very useful information as well. An additional great resource for users who would like to become more familiar with Lua\LaTeX\ is  \href{http://mirror.ctan.org/info/luatex/lualatex-doc/lualatex-doc.pdf}{A Guide to Lua\LaTeX} by Manuel Pégourié-Gonnard.


\subsection{Anything else I need do to get started?} \label{sec:anythingelse}

For multilingual support, Lua\LaTeX and the \pkg{selnolig} package work just fine with the \href{http://www.ctan.org/pkg/babel}{\pkg{babel}} package. This is in contrast to X\textsc{e}\LaTeX, which requires the use of the \href{http://www.ctan.org/pkg/polyglossia}{\pkg{polyglossia}} package. If your document loads the \pkg{babel} package, be sure to load the \pkg{selnolig} package \emph{after} the \pkg{babel} package, so that the additional hyphenation patterns provided by the \pkg{selnolig} package aren't overridden by any hyphenation settings provided by the \pkg{babel} package.

Lua\LaTeX\ natively supports the so-called UTF8 input encoding. The \pkg{selnolig} package assumes that users make full use of this feature. In particular, if your document is in German, it is assumed that all vowels with diereses (Umlaute) are entered as \Verb|ä|, \Verb|ö|, and \Verb|ü| rather than as \Verb|\"{a}|, \Verb|\"{o}|, and~\Verb|\"{u}| (or, if you tend to use the \pkg{babel} \enquote{shortcuts}, as \Verb|"a|, \Verb|"o|, and~\Verb|"u|). Likewise, it's assumed that you enter the \enquote{Eszett} (\emph{Scharfes~S}) character as |ß| rather than as |\{ss}|.\footnote{Actually, the use of the input characters with \enquote{built-in} diereses is required only for the operations of the package's \cmmd{nolig} and \cmmd{keeplig} commands.}

It is also assumed that you use the triple-f (modern) spelling form for words such as \texttt{Schifffahrt}, \texttt{Stofffarbe}, and \texttt{grifffest}.

Finally, if any \pkg{babel}-style \Verb+"|+ ligature-suppressing shortcuts are present in your document, you should either remove them or replace them with \Verb+\breaklig+ instructions. On my Lua\LaTeX\ system (MacTeX\,2012), whenever a \Verb+"|+ command is encountered, a bad crash occurs that requires a reboot of the system.


\section{Acknowledgments and license}

I owe a huge intellectual and programming debt to Patrick Gundlach and Taco Hoekwater, who responded kindly and generously with detailed computer code to various queries I posted to \href{http://tex.stackexchange.com}{\texttt{tex.stackexchange.com}}.\footnote{See especially the questions \url{http://tex.stackexchange.com/q/48516/5001}, \url{http://tex.stackexchange.com/q/63005/5001}, and
\url{http://tex.stackexchange.com/q/37443/5001}.} Without their expertise in programming in lua and interfacing the lua code with \LaTeX, this package would not exist. They certainly deserve most of the credit for the lua code used by the \pkg{selnolig} package.

Felix Lehmann (a linguist and expert in morphology, i.e., the study of morphemes) and Steffen Hildebrandt (computer scientist extraordinaire) served as patient and careful testers of several beta versions of this package, uncovering bugs, pointing out unclear passages in the user guide, and providing many excellent suggestions for important enhancements and other improvements. Steffen provided crucial modifications to the package's lua code to make possible the \cmmd{keeplig} macro. Equally importantly, Felix and Steffen created software to systematically and comprehensively test the package's German detection patterns for linguistic adequacy and (relative) completeness.

[Still to come: a brief statement what Felix and Steffen found, and a reference or two to their published work.]
They wish to thank the Institut für Maschinelle Sprachverarbeitung at the Universität Stuttgart for granting them a license for the morphological analysis tool SMOR and, in particular, Helmut Schmid for his guidance, the Web-as-Corpus kool ynitiative (WaCky) for letting them use the SdeWaC corpus.\footnote{M.~Baroni, S.~Bernardini, A.~Ferraresi and E.~Zanchetta, 2009, The WaCky Wide Web: A Collection of Very Large Linguistically Processed Web-Crawled Corpora. \emph{Language Resources and Evaluation}, 43~(3): 209--226.} They also thank Rajesh Bhatt (University of Massachusetts--Amherst), Miriam Butt (Universität Konstanz), and Sabine Schulte im Walde (Universität Stuttgart) for helping them find the right resources for their project.

The \href{http://www.ctan.org/tex-archive/support/rmligs}{\pkg{rmligs}} script lists hundreds of German language words for which f\nobreak-liga\-tures should be suppressed. I created many of the initial German language ligature suppression rules used in the \pkg{selnolig} package based on the words listed in the \pkg{rmligs} package.\footnote{All versions of \pkg{rmligs} are archived at \url{http://www.j3e.de/ispell/igerman98/dict/}. A slightly modified version of the \pkg{rmligs} package's test file, now called \opt{rmligs-testfile.tex}, is included among the ancillary files distributed with the \pkg{selnolig} package.} 

Other contributors to \url{tex.stackexchange.com} and \url{comp.text.tex}, too numerous to name individually, also helped guide and influence the genesis of this package. To all of you, I express my sincere thanks.

The website \url{http://www.morewords.com} provides very convenient methods for searching English language words that may contain cases of ligature collisions across morpheme boundaries. For German words, the site  \url{http://corpora.informatik.uni-leipzig.de/?dict=de} provides a similar resource. 

The entire \pkg{selnolig} package is placed under the terms of the \LaTeX Project Public License, version~1.3 or later (\url{http://www.latex-project.org/lppl.txt}).
It has the status \enquote{maintained.}


\section{Structure of the package}

The \pkg{selnolig} package has four main components:
\begin{itemize}
\item The main package file, \pkg{selnolig.sty},
\item lua code, contained in the file \pkg{selnolig.lua}, that provides low-level functions to set up the package's main user macros,
\item extensive lists of non-ligation rules (applied to either words or word fragments) for English and German language documents, contained in separate \pkg{.sty} files, and
\item a user guide (the document you're reading right now) and several ancillary files.
\end{itemize}

The \pkg{selnolig} package starts up as follows:
\begin{itemize}
\item The package's main file, called \pkg{selnolig.sty}, should be loaded in your document's preamble with a \cmmd{usepackage} statement with one or more options (see below). It is preferable that it be loaded \emph{after} the \pkg{fontspec} package is loaded and any ligature-setting commands are executed.
\item After setting up several Boolean switches designed to structure the processing of options, the package loads the file \pkg{selnolig.lua}, which contains the package's Lua code.
\item Next, the package's three user macros are set up:
\begin{enumerate}
\item The main user macro is called \cmmd{nolig}. Each \cmmd{nolig} instruction takes two arguments: a \enquote{search string} and a string that indicates the \enquote{insertion point} for the non-ligation \enquote{whatsit.} For example, the macro
    \begin{Verbatim}
         \nolig{lfful}{lf|ful}
    \end{Verbatim}
serves to suppress automatically the ff-ligature in words such as \enquote{shelfful}, \enquote{bookshelfful}, and \enquote{selffulfilling}. Note the use of the~\Verb/|/ symbol in the command's second argument to indicate which ligature should be suppressed. In principle, more than one ligature suppression point may be provided in the second argument of a \cmmd{nolig} instruction.

Observe also that the arguments of the \cmmd{nolig} command (as well as of the package's other user commands) are case-sensitive. 

\item The macro 
\begin{Verbatim}
      \keeplig{<word-fragment>}
\end{Verbatim}
lets users specify words and word fragments for which typographic ligatures should \emph{not} be suppressed anywhere in the document. In a sense, it's the exact opposite command to the command \cmmd{nolig}. 

Having this command is very useful for several reasons, but mainly because it allows us specify simpler, i.e., less restrictive, \cmmd{nolig} instructions. To give an example: if the \opt{ngerman} option is set, the package uses the macro 
\begin{Verbatim}
     \nolig{flich}{f|lich}
\end{Verbatim}
to break up the fl-ligature in words such as brieflich, tariflich, trefflich, hilflich, verwerflich, beruflich, sträflich, höflich, glimpflich, unerschöpflich and vortrefflich\textemdash and probably quite a few more words too. However, this macro is a bit too broad because it also operates on words such as Pf\breaklig licht and verpf\breaklig lichten, for which the fl-ligature should \emph{not} be suppressed. Rather than provide a plethora of slightly narrower \cmmd{nolig} macros just to avoid operating on the Pflicht-words, the package simply provides the commands
\begin{Verbatim}
     \keeplig{Pflicht}
     \keeplig{pflicht}
\end{Verbatim}
to override the action of the \Verb+\nolig{flich}{f|lich}+ instruction for all words that contain these word fragments.
\item The macro \cmmd{breaklig}, which doesn't take an argument, is provided as a hopefully easy-to-remember version of the low-level command \Verb+\hspace{0pt}+. As the name suggests, you should insert this macro in places where you want to break up a ligature on an ad-hoc basis. For instance, to suppress the \emph{sk} ligature in the word \Verb+groundskeeper+ on a one-off basis, one might enter it as \enquote{\Verb+grounds\textbackslash breaklig keeper+} to get {\ebg \emph{groundskeeper} rather than \emph{ground\mbox{sk}eeper}. } (To suppress the {\ebg \emph{sk}} ligature globally for this word as well as for words such as {\ebg \emph{greenskeeper}} and {\ebg \emph{miskeep}}, one could issue the directive \Verb+\nolig{skeep}{s|keep}+. The \pkg{selnolig} package does so.)

\end{enumerate}

Note that no separate macro for ad-hoc disabling of \cmmd{nolig} macros is provided. There is no real need for a new macro of this type, I believe, as the \LaTeX\ command \cmmd{mbox} is available for this purpose.


\item The next few steps in the loading process depend on which language-related options are set:
\begin{itemize}
\item If \emph{no} language-specific options are in effect, the loading process terminates. Users may still use the \cmmd{nolig}, \cmmd{keeplig}, and \cmmd{breaklig} instructions, but no predefined lists of language-specific \cmmd{nolig} macros are loaded.

\item If the \opt{english} option (or one of its synonymous options) is set, the files \pkg{selnolig-english-patterns.sty} and \pkg{selnolig-english-hyphex.sty} are loaded. The former file contains a long list of \cmmd{nolig} macros adapted to English language typographic usage, \Cref{sec:eng-listing} provides a complete listing of these macros. The latter file contains a list of hyphenation exceptions, mainly for words that contain one or more potential non-ligation points and for which \TeX's hypenation algorithm either misses valid hyphenation points or selects invalid hyphenation points, see \cref{sec:addlhyph} below.

\item If the \opt{ngerman} option (or one of its synonymous options) is set, the files \pkg{selnolig-german-patterns.sty} and \pkg{selnolig-german-hyphex.sty} are loaded. The former file contains ligature-suppressing instructions appropriate for German typographic usage, \cref{sec:germ-listing} lists its contents. The latter file provides additional hyphenation rules for German-language words.

\item If the user specifies both the \opt{english} and \opt{ngerman} options (and or some of their synonymous options), \emph{both} language-specific style files will be loaded. Under normal circumstances, a user will probably want to load only one or the other set of language-specific files, but not both sets.
\end{itemize}

\item The source code of the user guide of this package (the document you're currently reading) is available in the file \pkg{selnolig.tex}. 

\item The files \pkg{selnolig-english-test.tex} and \pkg{selnolig-german-test.tex} load the \pkg{selnolig} package as well as either \pkg{selnolig-english-wordlist.tex} or \pkg{selnolig-german-wordlist.tex}. They serve to demonstrate the output of the \pkg{selnolig} package when run on lists of English or German words that are candidates for non-use of ligatures. The files \pkg{selnolig-english-test.pdf} and \pkg{selnolig-german-test.pdf} contain the results of compiling the test programs.\footnote{The two \enquote{test} files also load the package \pkg{showhyphens} to indicate automatically all instances where Lua\LaTeX\ might insert hyphenation points.}

\end{itemize}


\section[The selnolig package's approach to breaking up ligatures]{The \pkg{selnolig} package's approach to breaking up ligatures}

The \cmmd{nolig} macros provided in the files \opt{selnolig-english-patterns.sty} (see \cref{sec:eng-listing}) and \opt{selnolig-german-patterns.sty} (see \cref{sec:germ-listing}) are primarily designed to break up ligatures\textemdash mainly f-ligatures, but potentially other ligatures as well\textemdash across \emph{morpheme} boundaries. 

Issues of inappropriately ligating character pairs and triples across morpheme boundaries can occur 
\begin{itemize}
\item if two independent or \enquote{main words} (Stammwörter) are joined together: \mbox{rooftop}\slash rooftop, \mbox{newspaper}\slash newspaper, \mbox{Schilffeld}\slash Schilffeld, \mbox{Brieftaube}\slash Brieftaube \phantom{x}   
\item between a prefix and main word: mi\mbox{st}rust\slash mistrust, di\mbox{sp}lay\slash display, \mbox{aufleben}\slash aufleben, \mbox{auftun}\slash auftun \phantom{x}
\item between a main word and a suffix: \mbox{shelfful}\slash shelfful, \mbox{dwarflike}\slash  dwarflike, \mbox{kopflos}\slash kopflos, and \mbox{höflich}\slash höflich. \phantom{x}
\end{itemize}

For German words, the following exceptions and adjustments apply:\footnote{These adjustments are culled from the rules stated in the \emph{Duden} and  various websites that have taken an interest in this subject.}
\begin{itemize}
\item Should the combination of a main word and suffix give rise to an fi or ffi ligature, this ligature is \emph{not} suppressed. Examples: streifig and affig. However, the fi and ffi ligatures \emph{are} suppressed if two main words are joined together: Schilfinsel, Zupfinstrument, and Baustoffingenieur.

\item For some borderline cases involving an fl ligature at the boundary of a main word (Stammwort) and suffix, preference is given to how the syllables are pronounced and how a word would be hyphenated. For instance, the words teuflisch (devilish) and schweflig (sulfurous) have their fl ligatures suppressed even though the f and~l characters belong to the same underlying morphemes, {viz.},\ Teuf(e)l and Schwef(e)l. For these words, the suffixes are -isch and -ig, respectively, rather than -lisch and -lig. Nevertheless, usage seems to be in such cases to follow the words' pronunciation and hyphenation patterns, resulting in a suppression of the f-l ligature. This rule also applies to the typesetting words such as knifflig (tricky) and mufflig (grouchy).

\item If a word could terminate with an fl ligature even though the~\enquote{l} technically belongs to a different morpheme (say, because of an abbreviation that's in effect), the fl ligature \emph{is used}. E.g., one writes Aufl.\ and gefl.\ with an fl ligature (but, when spelled out: Auflage and gefällig[s\breaklig t]).

\item This rule also suggests that ft and \char"E187\ ligatures are permitted in words such as geschärft, unbedarft, and erscha\char"E187, whereas they should be suppressed in words such as gestreifte, schlürfte, and raffte.

\item Here's a case for which I have not yet found a clear rule on how to proceed. If a main word ends in \enquote{ft} (e.g., Luft and Saft) and is followed by a suffix that starts with an~i, as in \opt{saftig} and \opt{luftig}, one could write saftig and luftig because the \opt{ft} character pair belongs to a single morpheme, \emph{or} one could give preference to the way the words are hyphenated and break up the ft-ligature to write saf\breaklig tig and luf\breaklig tig. For now, the \pkg{selnolig} package chooses the former option. I haven't found any clear references so far on how to treat this case. Expert help and guidance on this topic would be much appreciated.

\end{itemize}



\section{Options that govern the package's behavior}

\subsection{Main language options}

The \pkg{selnolig} package currently offers two main language-specific options: 
\begin{itemize}
\item \opt{english}, synonyms: \opt{british}, \opt{ukenglish}, \opt{UKenglish}, \opt{amer\-ican},  \opt{usenglish}, \opt{USenglish}, \opt{cana\-dian}, \opt{australian}, and \opt{new\-zealand}.
\item \opt{ngerman}, synonyms: \opt{german}, \opt{austrian}, \opt{naustrian}, \opt{swiss}, and \opt{swiss\-german}.
\end{itemize}
These language options may be used either individually or jointly. Indeed, this package's user guide was compiled with both the \opt{english} and \opt{ngerman} options set.\footnote{The ligature suppression patterns for the English-language and German-language segments of the package do not conflict with each other. The only \enquote{overlapping} word in the two packages is \enquote{offload}. (This word has apparently entered the German [!] vocabulary.)}

See \cref{sec:eng-listing,sec:germ-listing} for the complete listings of the package's English and German language ligature suppression rules.



\subsection{Other options}

\subsubsection[English language case: The broad-f and hdlig options]{English language case: The \opt{broad-f} and \opt{hdlig} options} \label{sec:eng-opt}

The ligature suppression patterns listed in \cref{sec:eng-listing} for English language words are grouped into four parts. The first two parts concern the suppression of various f-ligatures. Part~1 provides a fairly limited, or \enquote{basic}, set of patterns that will always be executed, and Part~2 contains a broader set of ligation suppression rules that will be executed if the \opt{broad-f} option is specified. 

For English-language documents, only a fairly small number of the f-ligature suppression rules is enabled by default, i.e., if the \opt{broad-f} option is not enabled. Eliminating \emph{all} f-ligatures that cross morpheme boundaries simply does not appear to be a major concern in English-language typography. Whereas many (maybe even most?) people would agree that it advisable not to use the ffi-ligature in words such as chaffinch and wolffish, and not to use the ffl-ligature in words such as scofflaw and offload, there appears to be far less of a perceived need to suppress the fi (ffi) ligature in the far more commonly occurring words that end in~f (ff) followed by the -ing, -ish, -ier, -iest, -ily, and -iness particles.\footnote{Examples of such words are sur\mbox{fi}ng, oa\mbox{fi}sh, lea\mbox{fi}er, goo\mbox{fi}est, flu\mbox{ff}ily, and goo\mbox{fi}ness.} The same goes for the~fl (ffl) ligature in words that end in~f (ff) followed by~-ly.\footnote{Examples are \mbox{aloofly} and \mbox{gruffly}.} That is why only a few f-ligature suppression macros are enabled by default if the \opt{english} option is set. To enable the broader set of f-ligature suppression rules, users must set the \opt{broad-f} option explicitly.

My choices regarding which f-ligature suppression rules belong to the \enquote{basic} and \enquote{broad} groups are almost entirely pragmatic. They are certainly not based on any overriding English-language typographic principles (which, possibly, don't even exist for the case at hand). However, if anyone happens to have a strong view on whether either \emph{fewer} or \emph{more} f-ligature suppression macros should be included in the \enquote{basic} group\textemdash especially if you can provide references to such discussions in learned circles\textemdash I would love to hear from you.


Part 3, which is enabled if the \opt{hdlig} option is set, provides ligature suppression patterns for the \emph{historic} (Adobe uses the term \enquote{quaint}) \mbox{ct}, \mbox{st}, and \mbox{sp} ligaturesin  words such as arctic, painstaking, display, and misplace. The sp ligature is also suppressed for words of Greek origin containing the \opt{sph} character triple, such as atmosphere and hemisphere, because in these cases the \opt{ph} character pair (which derives from the Greek letter $\phi$, or~$\varphi$) should not be obscured by the use of an~sp ligature.

Setting the \opt{hdlig} option also enables ligature suppression rules for additional \enquote{discretionary} ligatures such as \emph{th}, \emph{at}, and \emph{et}. For instance, rules are provided to suppress these ligatures in words such as \emph{ligh\mbox{th}ouse} and \emph{po\mbox{th}ole}, \emph{arom\mbox{at}herapy} and \emph{alb\mbox{at}ross}, and \emph{nin\mbox{et}y} and \emph{non\mbox{et}heless}.\footnote{Observe also that the words \emph{arom\mbox{at}herapy} and \emph{nonetheless} are cases where one discretionary ligature (\emph{at} and \emph{et}, resp.)\ can pre-empt the use of a subsequent, and possibly more desirable, ligature (here: \emph{th}), \emph{cf.}\ the appearance of \emph{aroma\breaklig therapy} and \emph{none\breaklig theless}. This issue is discussed in more detail in \cref{sec:preempt}.} Currently, ligature suppression rules are provided for the following discretionary ligatures: \emph{th}, \emph{at}, \emph{et}, \emph{as}, \emph{is}, \emph{us},  {\ebg \emph{sk}},  \emph{ll}, and~\emph{fr}. Part~4 of \cref{sec:eng-listing} lists these rules.

Part 4 of this file, which is also processed if the \opt{hdlig} option is set, deals with cases where one discretionary typographic literature, say \emph{as}, pre-empts the use of a typographic ligature, say \emph{st} or \emph{sp}, in words such as \emph{f\mbox{as}t}\slash \emph{fast} and \emph{cl\mbox{as}p}\slash \emph{clasp}. Note that the issue being addressed in this part is not that of a ligature crossing a morpheme boundary but of one typographic ligature pre-empting the use of a more appropriate or more important ligature. This issue is discussed in more detail in \cref{sec:preempt} below.



\subsubsection{Additional hyphenation exception patterns} \label{sec:addlhyph}

\TeX's hyphenation algorithms are widely acknowledged to be very good. However, for the English language case at least, it tends to miss quite a few permissible hyphenation points when dealing with words that end in -fing, -\mbox{ffi}ng, -fier, -\mbox{ffi}er, -fiest, -\mbox{fl}ess, -\mbox{fl}ike, etc. Hyphenation exception lists are provided in the files \pkg{selnolig-english-hyphex.sty} and \pkg{selnolig-german-hyphex.sty}, respectively, for English and German words.

The German-language hyphenation exception list is currently much the shorter of the two. This is because it is assumed that writers of German-language documents use the \pkg{babel} package with the \opt{ngerman} option (or one of the synonymous options) set, doing so also loads specialized hyphenation patterns suitable for German text. The German hyphenation exception list of the \pkg{selnolig} package is set up to deal with a fairly short list of words for which I've noticed that \pkg{babel}'s hyphenation algorithm throws errors, e.g., for words such as Kau-f-in-dex, Lau-f-in-dex, Schif-fer-b-art, Schil-fin-sel, and Schil-f-feld.

It is possible to instruct \pkg{selnolig} \emph{not} to load these hyphenation exception lists. You may want to do so, say, if you must use UK-English hyphenation patterns and can't make use of US-English hyphenation patterns, which is what's provided by the package. To skip loading the additional hyphenation patterns, you need to specify the option \opt{noadditional\-hyphen\-a\-tion\-patterns} when loading the \pkg{selnolig} package.\footnote{I am obviously not trying to make it too easy to invoke this option~\dots}

As was already noted in \cref{sec:anythingelse}, if you use the \pkg{babel} package with, say the \opt{ngerman} option, be sure to load \pkg{selnolig} package \emph{after} the babel package so that the additional hyphenation exception patterns aren't overridden by \pkg{babel}'s settings.

Incidentally, if the files \pkg{selnolig-english-hyphex.sty} and \pkg{selnolig-german-hyphex.sty} are located in a directory that's in the search path of your TeX distribution, these packages may be loaded by users via the usual \cmmd{usepackage} statements without having to load the entire \pkg{selnolig} package.


\subsubsection[Controlling how much is written to the .log file]{Controlling how much is written to the \opt{.log} file}

By default, none of the inner workings of the \pkg{selnolig} package are written to the \opt{.log} file. However, if you execute the command \cmmd{debugon}, detailed information about each pattern match that is encountered is written to the \opt{.log} file. For instance, if the German word \enquote{Auflaufform}\textemdash which happens to have \emph{two} f-ligatures that need to be suppressed\textemdash is encountered, the following lines are written to the \opt{.log} file:
\begin{Verbatim}
     pattern match: Auflaufform - fform
     pattern match: Auflaufform - flauf
     Do ligature suppression for: Auflaufform
     Match: fform
     Position 9
     Match: flauf
     Position 5
     Liga table: 00010001000
     Inserting noliga whatsit before glyph: l
     Inserting noliga whatsit before glyph: f
\end{Verbatim}
Note that the \pkg{selnolig} package lets two separate \cmmd{nolig} commands, one for the string \opt{fform} and the other for the string \opt{flauf}, operate concurrently on one word. Note also that executing \cmmd{debugon} will result in fairly copious amounts of information being written to the log file.



\section{Further issues}

\subsection{Known bugs}

Remark: The first four bugs in the following list may turn out to be related, i.e., may be caused by a single bug in the package's lua code.
\begin{enumerate}
\item The \cmmd{nolig} search-and-nolig-whatsit-insertion patterns do not appear to work properly on the final word in the argument of a command (e.g., |\footnote{}| and |\section{}|) \emph{unless} that  word (including any trailing punctuation mark) is followed by one or more space characters before the closing curly brace of the command's argument is encountered. 

For instance, the fl ligature in \enquote{kop\mbox{fl}os} is not broken up by either |\footnote{kopflos.}| or |\section{Kopflosigkeit}|. The package does work as expected if the commands are modified to |\footnote{kopflos. }| and |\section{Kopflosigkeit }|.

\item The \cmmd{nolig} search-and-insert patterns also don't seem to work on words (including, if present, any trailing punctuation marks) that are followed immediately by a |%| (comment) character. The workaround is the same as for the preceding bug: be sure to leave one or more spaces between the word and the comment character.

\item If an item in an itemize or enumerate environment \emph{ends} with a word containg a ligature that should be suppressed (plus, possibly, an associated punctuation mark)\textemdash i.e., if it is followed immediately by another \cmmd{item} directive or an \Verb+\end{itemize}+ or \Verb+\end{enumerate}+ statement\textemdash the ligature suppression again fails. The remedy in this circumstance is to leave a blank line between the end of one \cmmd{item}'s content and the next \cmmd{item} instruction or the \Verb+\end{itemize}+ or \Verb+\end{enumerate}+ instruction.

\item If the final word (again, possibly, with an associated punctuation character) in a sentence immediately \emph{prior} to the start of an enumerate, itemize, or other such environment contains a ligature that should be suppressed, the |\nolig| macro again will not work properly. The recommended remedy is to leave a blank line between that sentence and the start of the environment in question. Inserting an \enquote{invisible} instruction such as \Verb+\vphantom{x}+ also works.

\item The |\nolig| search-and-insert operations currently don't work properly if the first part of the search string, i.e., the part \emph{before} the \Verb+|+~symbol, contains a character with an Umlaut (dieresis) or other diacritic. 

\item I'm not sure if the following amounts to a bug or  \enquote{just} a case of incompatibility between two packages. The \pkg{selnolig} package does not appear to interact well with the \pkg{ngerman} package\textemdash even though it interacts nicely with the \pkg{babel} package (with one or more of the \opt{ngerman}, \opt{german}, \opt{austrian}, and \opt{naustrian} options set.) However, unless someone can convince me that using the \pkg{ngerman} package is truly preferable to using the \pkg{babel} package with one of the available German-language options, I probably won't bother figuring out how to fix this incompatibility.
\end{enumerate}


\subsection{Composite words made up of two different sets of primitive words}

More so in German than in English, there may be composite words which are made up of two different pairs of primitive words. For instance, the word \opt{Saufladen} may be constructed as \opt{Sauf-laden} or as \opt{Sau-fladen}, and the word \opt{Wachstube} could be constructed as \opt{Wachs-tube} or as \opt{Wach-stube}. In one case, using the fl and st ligatures would be wrong, in the other, using the ligatures would help greatly in indicating the intended meaning of the composite words. 

It turns out that if the \opt{ngerman} option is set and the \pkg{babel} package is loaded as well, the \opt{selnolig} package will break up the fl ligature in \opt{Saufladen} but not the st ligature in \opt{Wachstube}, i.e., the words will be typeset as \enquote{Saufladen} and \enquote{Wachstube}, respectively. If that's not what you want, you'll need to mark up the words explicitly, say as follows: \Verb+Sau\keeplig{fl}aden+ and \Verb+Wachs\breaklig tube+. One could, of course, also insert explicit hyphen characters to indicate unambiguously the intended meanings.



\subsection{Lists of words fitting German and English language non-ligation patterns}

Extensive lists of German and English language words for which one or more ligatures should be suppressed are provided in the files \pkg{selnolig-german-wordlist.tex} and \pkg{selnolig-english-wordlist.tex}. I started the list of German language words with the examples provided by the \pkg{rmligs} package, but have managed to come up with quite a few more words since starting to put together the \pkg{selnolig} package. Obviously, I can't and won't make a claim that either of these lists is complete. Suggestions for additional words are always welcome.

The files \pkg{selnolig-german-test.tex} and \pkg{selnolig-english-text.tex} are \enquote{driver programs} that load the \pkg{selnolig} package and then run it on the respective lists of German- and English-language words. To compile the driver programs, be sure to use Lua\LaTeX.


\subsection{How to provide additional ligature suppression patterns}

As already noted, it's not possible to claim that the non-ligation search-and-insert patterns set up in \pkg{selnolig-english-patterns.sty} and \pkg{selnolig-german-patterns.sty} are complete (or, for that matter, ever will be entirely complete). If you come across words containg ligatures that ought to be suppressed but aren't caught by the rules set up by the package's files, it is straightforward to create one or more new non-ligation rules to deal with the cases you've discovered.

Suppose, say, that you're preparing a special edition of Thomas Mann's novel \enquote{Der Tod in Venedig} (using an Antiqua font since very few people nowadays can still read {\blackletterfont blackletter} text with ease\dots) and notice that the \pkg{selnolig} package does not appear to include a macro to suppress the unwanted ffl-ligature in the word \enquote{inbegri\mbox{ffl}eitend}.\footnote{This word really does occur in the aforementioned novel!} To rectify this problem, while simultaneously creating a search pattern that will also catch cases of inappropriate ffl-ligatures in the (hopefully more common~\ldots) words  \enquote{Jugendtre\mbox{ffl}eiter} and \enquote{Kunststo\mbox{ffl}eitung}, you could add the following \Verb+\nolig+ macro to your document's preamble:
\begin{Verbatim}
     \nolig{ffleit}{ff|leit}
\end{Verbatim}
With this macro in place, the words will now be typeset as inbegriffleitend, Jugendtreffleiter, and Kunststoffleitung.\footnote{In fact, the file \pkg{selnolig-german-patterns.sty} provides the less-restrictive macro \Verb+\nolig{fleit}{f|leit}+ to take care of these words as well as quite a few more. The case of the surname Kaltefleiter, for which use of the fl ligature is presumably correct, may be handled via an \cmmd{keeplig} macro.}



\subsection[How to use the selnolig package to suppress ligatures for certain character pairs globally]{How to use the selnolig package to suppress ligatures for certain character pairs \emph{globally}}
\label{sec:global-nolig}


The main purpose of the \pkg{selnolig} package is, obviously, to disable certain ligatures selectively. However, it can also be used to suppress ligation globally for selected character pairs.\footnote{I first became aware of the potential need for such a feature after reading Frank Mittelbach's posting, \href{http://tex.stackexchange.com/q/61042/5001}{Suppress certain ligatures generally}, on \url{tex.stackexchange.com}.}

\bgroup \ebg

Suppose, for instance, that you have a font that provides ligatures for the \mbox{fb}, \mbox{fh}, \mbox{fj}, and \mbox{fk} character pairs (as well as, possibly, the \mbox{ffb}, \mbox{ffh}, \mbox{ffj}, and \mbox{ffk} character triples). If you wanted to suppress the four former f-ligatures globally (and also break up the latter ligatures as ff-b, ff-h, ff-j, and~ff-k, respectively), you could do so by issuing the following commands: \egroup
\begin{Verbatim}
     \nolig{fb}{f|b}
     \nolig{fh}{f|h}
     \nolig{fj}{f|j}
     \nolig{fk}{f|k}
\end{Verbatim}
In fact, these commands are already included among the \cmmd{nolig} macros that are enabled if the package's \opt{ngerman} option is set. This is done because I was unable to come up with a single instance of a \emph{German} language word involving these character combinations that doesn't also involve a morpheme boundary collision.\footnote{These four macros are also enabled if the \pkg{selnolig} package's \opt{english} and \opt{broad-f} options are set.}


Of course, you may have some \emph{non-German} language words in your document for which you would not necessarily want to suppress these ligatures. \bgroup \ebg Suppose, say, that you need to typeset the name \opt{Kafka} and do not wish to suppress the \mbox{fk}-ligature for this specific word. To override the global setting created by the \Verb+\nolig{fb}{f|b}+ macro, you'll need to write each instance of this word as 
\Verb+Ka\mbox{fk}a+
to generate Ka\mbox{fk}a. Alternatively\textemdash and this is the \enquote{solution} implemented by the \pkg{selnolig} package\textemdash one may provide suitable \cmmd{keeplig} macros to preserve the \mbox{fk}-ligature in names such as Kafka, Safka, Piefke, Potrafke, Sprafke, Shirafkan, and Tirafkan. \egroup



Or, suppose the \pkg{selnolig} package's \opt{ngerman} option is enabled and your document features some words of \emph{Nordic} origin containing the \opt{fj} character pair, such as Sogne\-\mbox{fj}ord and Dovre\-\mbox{fj}ell. Observe that because the \opt{fj} character pair contained in these words does not span a morpheme boundary, the \mbox{fj}-ligature need not be broken up. To deal with this category of words, \cmmd{keeplig} macros are provided for words containing the particles fjord, fjell, fjäll, and fjör as well as for names such as Eefje, Sufjan, Prokofjew, and Astafjew.



\subsection{What if one ligature pre-empts a subsequent, more appropriate ligature?} \label{sec:preempt}

If a font provides many discretionary ligatures, the likelihood increases that the use of a ligature for the first two characters of a character \emph{triple} might pre-empt the use of a more appropriate ligature for the last two characters of that triple.\footnote{To be sure, this issue is not limited to just \enquote{discretionary} ligatures, it can also occur with f-ligatures. Consider the \opt{ffi} and \opt{ffl} character triples, and suppose that a certain font provides ff, fi, and fl ligatures but no ffi and ffl ligatures. Left to its own devices, \TeX\ would let the ff ligature pre-empt any trailing fi and fl ligatures, leading to typographically incorrect outcomes for words such as au\mbox{ff}inden (better: auffinden) and Scha\mbox{ff}leisch (better: Schaffleisch). \label{fn:triple}} 

In this section, we examine the use of \cmmd{nolig} instructions to address this contingency, focusing on cases of \emph{st}, \emph{sp}, \emph{th}, and \emph{ta} character pairs being preceded by character pairs (for which the font provides ligatures) that end in~\emph{s} or~\emph{t}, respectively. This focus is dictated largely by the discretionary ligatures provided by the text font used for this user guide (Garamond Premier Pro). Other ligature-rich fonts may provide further possibilities for one ligature inappropriately pre-empting that for a trailing character pair.\footnote{For the Garamond Premier Pro text font, I've discovered the following exception to the general rule that \TeX\ always gives precedence to a ligature for the first two characters of a character triple: for the character triple \opt{fis} (as in \opt{fish} and \opt{fist}), \TeX\ gives preference to the trailing \emph{is} ligature over the preceding \emph{fi} ligature, causing these words to be typeset as \emph{f\mbox{is}h} and \emph{f\mbox{is}t}, respectively. Not having access to other fonts that provide both~\emph{fi} and~\emph{is} ligatures, I can't tell if is a conscious design feature or a bug. For now, the \pkg{selnolig} is set to override this behavior, i.e., to always give preference to the \emph{fi} ligature over the trailing \emph{is} ligature for words that contain the strings \opt{fish} and \opt{fist}, hence, they'll be rendered as \emph{fish} and \emph{fist}, respectively.}



\subsubsection{Ligatures for \emph{as}, \emph{is}, and \emph{us} that pre-empt an \emph{st} ligature}

Suppose that the text font in use provides ligatures for the \emph{as}, \emph{is}, and \emph{us} character pairs as well as for the \emph{st} character pair. By TeX's rules for forming typographic ligatures, words that contain the character \emph{triples} \opt{ast}, \opt{ist}, or \opt{ust} will see the first two characters ligated, pre-empting the use of a typographic ligature for the trailing \emph{st} character pair. There are three separate reasons why this outcome may not be desirable.

First, given the rather distinctive look of the \emph{st}~ligature, the word \opt{stochastic} may look a bit odd if the \emph{st} ligature is used only once\textemdash\emph{stoch\mbox{as}tic}\textemdash simply because the \emph{as} ligature pre-empts the second \emph{st} ligature, readers may prefer the look of \emph{stocha\mbox{st}ic}. Second, non-use of the st/\emph{st} ligature may be undesirable if the same word occurs twice and in close visual proximity, once set in the upright font shape\textemdash for which there are no ligatures for the \opt{as}, \opt{is}, and \opt{us} character pairs, and hence for which the issue of ligature pre-emption doesn't arise\textemdash and once in italics: must vs.\ \emph{m\mbox{us}t}, readers may prefer the look of must vs.\ \emph{mu\mbox{st}}.\footnote{For afficionados of these discretionary ligatures: Do you like the look of \emph{Do f\mbox{as}t festive f\mbox{is}ts foster f\mbox{us}tiness?}, or do you prefer the look of \emph{Do fa\mbox{st} festive fi\mbox{st}s foster fu\mbox{st}iness?}} Third, there may be cases where an \emph{as} ligature not only pre-empts a subsequent \emph{st} ligature but also spans a morpheme boundary, as in the words \emph{infr\mbox{as}tructure} and \emph{se\mbox{as}trand}.\footnote{This case was already noted in \cref{fn:triple}, where two words are noted for which the ff-ligature, which might improperly pre-empt fi- and fl-ligatures, happens to span a morpheme boundary.} For such words, the \emph{as} ligature should probably be suppressed in any case to increase the words' legibility: \emph{infra\mbox{st}ructure} and \emph{sea\mbox{st}rand}.

If you employ these discretionary ligatures in your documents and if the package's \opt{hdlig} option is set, it is assumed that you prefer giving preference to the distinctive-looking \emph{st} ligature over \emph{as}, \emph{is}, and \emph{us} ligatures. The following commands are therefore provided:\footnote{Be aware, though, that the second of these three commands, while correct for most words that contain the string \opt{ist}, unnecessarily suppresses the \emph{is} ligature for words where the \emph{st} character pair crosses a morpheme boundary. Examples of this case are words that start with \emph{dis-t\ldots}\textemdash e.g., \emph{distend, distribute, distrust, disturb}\textemdash or with \emph{mis-t\ldots}\textemdash e.g., \emph{mistake, mistranslate, mistype}. (Note that the st/\emph{st} ligature is already\textemdash and appropriately!\textemdash suppressed for these words.) At this time there are no plans to address this (overall minor?) problem.}
\begin{Verbatim}
     \nolig{ast}{a|st}
     \nolig{ist}{i|st}
     \nolig{ust}{u|st}
\end{Verbatim}



\subsubsection{Ligatures for \emph{as}, \emph{is}, and \emph{us} that pre-empt an \emph{sp} ligature}

The same three reasons for not letting \emph{as}, \emph{is}, and \emph{us} ligatures pre-empt an \emph{st} ligature also apply to the case of the equally distinctive looking \emph{sp} ligature. The \pkg{selnolig} package therefore provides macros to ensure the use of the trailing \emph{sp} ligature in words such as \emph{clasp}, \emph{hasp}, \emph{hispanic}, \emph{raspberry}, \emph{teaspoon}, \emph{wasp}, \emph{crisp}, \emph{lisp}, \emph{whisper}, \emph{wispy}, and \emph{cusp}. 




\subsubsection{Ligatures for \emph{at} and \emph{et} that pre-empt a \emph{th} ligature}

Suppose that a font provides ligatures for the \emph{at}, \emph{et}, and \emph{th} character pairs. By \TeX's rules for forming ligatures, without special intervention the word \opt{mathematics} will be typeset as \emph{m\mbox{at}hematics} rather than as \emph{mathematics} because the \emph{at} ligature pre-empts use of the \emph{th} ligature. The same happens for words such as \emph{b\mbox{at}h}, \emph{K\mbox{at}hryn}, and \emph{p\mbox{at}hology}.\footnote{A longer list of words for which the \emph{at} ligature pre-empts the \emph{th} ligature is given in the ancillary document \pkg{selnolig-english-test.pdf}. }
Given the prevalence and distinctive pronuciation of the \opt{th} character pair in the English language, as well as the high frequency of this character pair in words of Greek origin (for which the Latin-alphabet \opt{th} character pair derives from the Greek character $\theta$, or~$\vartheta$), it seems undesirable to let the \emph{at}-ligature pre-empt the \emph{th} ligature for these words. 

Fixing the \emph{at}--\emph{th} ligature pre-emption issue globally, e.g., via \Verb+\nolig{ath}{a|th}+, is not completely innocuous because doing so will also suppress the \emph{at} ligature for words such as \opt{boathook} and \opt{rathole}, for which the \emph{th} ligature would span a morpheme boundary and thus shouldn't be employed anyway. For such words, then, there's no need to suppress the \emph{at} ligature. These cases are dealt with by providing \cmmd{keeplig} macros that deliberately let the \emph{at} ligature take precedence over the trailing \emph{th} ligature.

Suppressing an \emph{et} ligature in favor of a subsequent \emph{th} ligature via \Verb+\nolig{eth}{e|th}+ is almost universally correct, either because the \emph{th} ligature \emph{should} take precedence\textemdash as in the words \emph{ethics}, \emph{methane}, and \emph{teeth}\textemdash or because the \emph{et} ligature would cross a morpheme boundary and hence shouldn't be used anyway, as in the words \emph{forethought} and \emph{rethink}. 

I say that it's \emph{almost} universally correct to do so because there are some words, such as \opt{Beethoven}, \opt{prophethood}, and \opt{sweetheart}, for which the \emph{th} ligature would be inappropriate anyway and hence the use of the \emph{et} ligature would be unproblematic. 
To address this issue, \cmmd{keeplig} macros are provided for these words, deliberately letting the \emph{et} ligature take precedence over the \emph{th} ligature and resulting in them being typeset as \emph{Beethoven}, \emph{prophethood}, and \emph{sweetheart}, respectively.\footnote{Note that this method works if the font being used provides \emph{both} \emph{et} and \emph{th} ligatures. If the text font you employ provides only the \emph{th} ligature but not the \emph{et} ligature, these \cmmd{keeplig} macros should be disabled.}


\subsubsection{Ligatures for \emph{at} and \emph{et} that pre-empt a \emph{ta} ligature}

There seem to be only very few words for which an \emph{at} ligature might inappropriately pre-empt a more important \emph{ta} ligature. One such word is \opt{atap}, which may be more readable if it's typeset as~\emph{a\mbox{ta}p} rather than as \emph{atap}.\footnote{It's not advisable, however, to specify a macro such as \Verb+\nolig{atap}{a|tap}+ to address this case because of words such as \emph{catapult} and \emph{catacomb}, for which the use of the \emph{at} ligature is presumably innocuous. Somebody please correct me if this assumption is not correct.}  Because of the apparent paucity of such cases, I have decided for now not to provide specific ligature suppression rules to handle them.

To the best of my (admittedly not exhaustive) knowledge, all words for which an \emph{et} ligature might inappropriately pre-empt the use of a trailing \emph{ta} ligature are words for which the \emph{et} ligature crosses a morpheme boundary and hence probably shouldn't be used anyway.\footnote{Examples are \emph{betake, betatter, bristletail, caretaker, cheetah, detach, detail, detain, dovetail, foretaste, horsetail, pretake, pretax, retable, retack, retard, retarget, timetable, whitetail, \emph{and} wiretap}. } As such, the \emph{et}-related ligature suppression rules already in place, which are set up to deal with morpheme boundary crossing cases, should suffice to catch these cases as well.



\appendix

\small

\section[The package's main style file: selnolig.sty]
{The package's main style file: \pkg{selnolig.sty}}

\VerbatimInput{selnolig.sty}

\clearpage
\section[The package's lua code: selnolig.lua]{The package's lua code: \pkg{selnolig.lua}}
\label{sec:luacode}

\VerbatimInput{selnolig.lua}

\clearpage
\newgeometry{hmargin=1in}

\section[English-language ligature suppression patterns: selnolig-english-patterns.sty]{English-language ligature suppression patterns: \\ 
\pkg{selnolig-english-patterns.sty}}
\label{sec:eng-listing}

\begin{multicols}{2}
\VerbatimInput{selnolig-english-patterns.sty}
\end{multicols}

\clearpage
\section[German-language ligature suppression patterns:
selnolig-german-patterns.sty]{German-language ligature suppression patterns: \\ 
\pkg{selnolig-german-patterns.sty}}
\label{sec:germ-listing}

\begin{multicols}{2}

Introductory notes: 
\begin{itemize}
\item Macros that don't work quite right yet are commented out with \Verb/%%%%%/ markers. 
(The reason these macros don't work quite right is that the search strings contain an Umlaut character in the part \emph{before} the ligation-suppression point. Hopefully, this issue will be fixed soon.)

\item To accommodate the practice of Swiss-German writers of not using the \enquote{ß} character (and using \enquote{ss} in its place), all search-and-insert strings that contain an \enquote{ß} character are duplicated with equivelent search-and-insert strings that contain \enquote{ss} instead.

\end{itemize}


\VerbatimInput{selnolig-german-patterns.sty}
\end{multicols}

\clearpage
\section[Reporting bugs and other issues with the selnolig package: A suggested template]{Reporting bugs and other issues with the selnolig package:\\A suggested template} \label{sec:template}

\VerbatimInput{selnolig-bugreport.tex}


\end{document}
